<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Fun√ß√µes de Otimiza√ß√£o de Rotas do Calend√°rio</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0D1017 0%, #1A1D29 100%);
            color: #F1F1F1;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #23263B;
            border-radius: 16px;
            padding: 30px;
            border: 2px solid #2D3142;
        }
        
        .test-section {
            background: #2D3142;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #5F5CFF;
        }
        
        .test-button {
            background: linear-gradient(135deg, #5F5CFF 0%, #7C78FF 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(95, 92, 255, 0.4);
        }
        
        .result-box {
            background: #1A1D29;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #3A3F56;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .success { color: #6EE7B7; }
        .error { color: #ff6b6b; }
        .info { color: #74c0fc; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste das Fun√ß√µes de Otimiza√ß√£o de Rotas - Calend√°rio PNSB 2024</h1>
        
        <div class="test-section">
            <h2>üìç Teste de Algoritmo de Otimiza√ß√£o</h2>
            <p>Testa o algoritmo Nearest Neighbor com munic√≠pios de Santa Catarina</p>
            <button class="test-button" onclick="testarAlgoritmoOtimizacao()">
                Testar Algoritmo
            </button>
            <div id="result-algorithm" class="result-box" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>üìä Teste de C√°lculo de Estat√≠sticas</h2>
            <p>Calcula dist√¢ncia, tempo e combust√≠vel para uma rota</p>
            <button class="test-button" onclick="testarCalculoEstatisticas()">
                Testar Estat√≠sticas
            </button>
            <div id="result-stats" class="result-box" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>‚è∞ Teste de Gera√ß√£o de Hor√°rios</h2>
            <p>Gera cronograma de visitas com hor√°rios estimados</p>
            <button class="test-button" onclick="testarGeracaoHorarios()">
                Testar Hor√°rios
            </button>
            <div id="result-schedule" class="result-box" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>üó∫Ô∏è Teste de Coordenadas e Dist√¢ncias</h2>
            <p>Verifica c√°lculo de dist√¢ncias entre munic√≠pios</p>
            <button class="test-button" onclick="testarDistancias()">
                Testar Dist√¢ncias
            </button>
            <div id="result-distances" class="result-box" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>üìÑ Teste de Exporta√ß√£o CSV</h2>
            <p>Simula gera√ß√£o de arquivo CSV com rota otimizada</p>
            <button class="test-button" onclick="testarExportacaoCSV()">
                Testar Exporta√ß√£o
            </button>
            <div id="result-csv" class="result-box" style="display: none;"></div>
        </div>
    </div>

    <script>
        // ========================================
        // FUN√á√ïES COPIADAS DO CALEND√ÅRIO MODERNO
        // ========================================

        // Coordenadas dos munic√≠pios PNSB SC + Base IBGE
        const COORDENADAS_MUNICIPIOS = {
            'Balne√°rio Cambori√∫': {lat: -26.9908, lng: -48.6354},
            'Balne√°rio Pi√ßarras': {lat: -26.7544, lng: -48.6719},
            'Bombinhas': {lat: -27.1486, lng: -48.4814},
            'Cambori√∫': {lat: -27.0231, lng: -48.6556},
            'Itaja√≠': {lat: -26.9076, lng: -48.6646},
            'Itapema': {lat: -27.0897, lng: -48.6131},
            'Luiz Alves': {lat: -26.7139, lng: -48.9331},
            'Navegantes': {lat: -26.8986, lng: -48.6558},
            'Penha': {lat: -26.7711, lng: -48.6467},
            'Porto Belo': {lat: -27.1581, lng: -48.5503},
            'Ilhota': {lat: -26.8983, lng: -48.8322}
        };

        // Base operacional IBGE Itaja√≠
        const BASE_IBGE_ITAJAI = {
            nome: 'IBGE Itaja√≠',
            endereco: 'Rua Cambori√∫ 26, Centro - Itaja√≠, SC',
            coordenadas: {lat: -26.9060, lng: -48.6631} // Coordenadas precisas da Rua Cambori√∫ 26
        };

        // Fun√ß√£o para calcular dist√¢ncia (Haversine)
        function calcularDistancia(ponto1, ponto2) {
            const R = 6371; // Raio da Terra em km
            const dLat = (ponto2.lat - ponto1.lat) * Math.PI / 180;
            const dLng = (ponto2.lng - ponto1.lng) * Math.PI / 180;
            
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(ponto1.lat * Math.PI / 180) * Math.cos(ponto2.lat * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Algoritmo de otimiza√ß√£o de rota (Nearest Neighbor)
        function otimizarSequenciaMunicipios(municipios) {
            if (municipios.length <= 1) return municipios;
            
            let rotaFinal = [];
            let municipiosRestantes = [...municipios];
            
            // Come√ßar com Itaja√≠ se estiver na lista (base operacional)
            let atual = municipiosRestantes.find(m => m === 'Itaja√≠') || municipiosRestantes[0];
            rotaFinal.push(atual);
            municipiosRestantes = municipiosRestantes.filter(m => m !== atual);
            
            while (municipiosRestantes.length > 0) {
                let proximo = null;
                let menorDistancia = Infinity;
                
                municipiosRestantes.forEach(municipio => {
                    const distancia = calcularDistancia(
                        COORDENADAS_MUNICIPIOS[atual], 
                        COORDENADAS_MUNICIPIOS[municipio]
                    );
                    
                    if (distancia < menorDistancia) {
                        menorDistancia = distancia;
                        proximo = municipio;
                    }
                });
                
                if (proximo) {
                    rotaFinal.push(proximo);
                    municipiosRestantes = municipiosRestantes.filter(m => m !== proximo);
                    atual = proximo;
                }
            }
            
            return rotaFinal;
        }

        // Calcular estat√≠sticas da rota
        function calcularEstatisticasRota(municipios) {
            if (municipios.length < 2) {
                return { distanciaTotal: 0, tempoEstimado: 0, combustivel: 0 };
            }
            
            let distanciaTotal = 0;
            
            for (let i = 0; i < municipios.length - 1; i++) {
                const atual = COORDENADAS_MUNICIPIOS[municipios[i]];
                const proximo = COORDENADAS_MUNICIPIOS[municipios[i + 1]];
                distanciaTotal += calcularDistancia(atual, proximo);
            }
            
            // Estimativas
            const tempoEstimado = (distanciaTotal / 50) * 60 + (municipios.length * 120); // 50km/h + 2h por visita
            const combustivel = distanciaTotal / 12; // 12km/l estimado
            
            return {
                distanciaTotal: Math.round(distanciaTotal),
                tempoEstimado: Math.round(tempoEstimado),
                combustivel: Math.round(combustivel * 10) / 10
            };
        }

        // Gerar hor√°rios para a rota
        function gerarHorariosRota(municipios) {
            const horaInicio = new Date();
            horaInicio.setHours(8, 0, 0, 0); // Iniciar √†s 8:00
            
            let horaAtual = new Date(horaInicio);
            
            return municipios.map((municipio, index) => {
                // Tempo de viagem: 30min para o primeiro, 45min entre munic√≠pios
                const tempoViagem = index === 0 ? 30 : 45;
                horaAtual = new Date(horaAtual.getTime() + (tempoViagem * 60 * 1000));
                
                const chegada = new Date(horaAtual);
                const saida = new Date(horaAtual.getTime() + (120 * 60 * 1000)); // 2h por visita
                
                horaAtual = saida;
                
                return {
                    municipio,
                    chegada: chegada.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'}),
                    saida: saida.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})
                };
            });
        }

        // ========================================
        // FUN√á√ïES DE TESTE
        // ========================================

        function testarAlgoritmoOtimizacao() {
            const resultDiv = document.getElementById('result-algorithm');
            resultDiv.style.display = 'block';
            
            try {
                // Teste com alguns munic√≠pios
                const municipiosOriginal = ['Bombinhas', 'Itaja√≠', 'Navegantes', 'Balne√°rio Cambori√∫', 'Porto Belo'];
                const rotaOtimizada = otimizarSequenciaMunicipios(municipiosOriginal);
                
                let resultado = '‚úÖ TESTE DE OTIMIZA√á√ÉO DE ROTA\n\n';
                resultado += `üéØ Munic√≠pios originais: ${municipiosOriginal.join(' ‚Üí ')}\n\n`;
                resultado += `üöó Rota otimizada: ${rotaOtimizada.join(' ‚Üí ')}\n\n`;
                resultado += `üìä Resultado: A rota foi reorganizada priorizando dist√¢ncias menores.\n`;
                resultado += `Base operacional: ${rotaOtimizada[0]} (primeiro munic√≠pio visitado)\n`;
                
                resultDiv.innerHTML = `<span class="success">${resultado}</span>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
            }
        }

        function testarCalculoEstatisticas() {
            const resultDiv = document.getElementById('result-stats');
            resultDiv.style.display = 'block';
            
            try {
                const municipios = ['Itaja√≠', 'Navegantes', 'Balne√°rio Cambori√∫', 'Bombinhas'];
                const estatisticas = calcularEstatisticasRota(municipios);
                
                let resultado = 'üìä TESTE DE C√ÅLCULO DE ESTAT√çSTICAS\n\n';
                resultado += `üó∫Ô∏è Rota: ${municipios.join(' ‚Üí ')}\n\n`;
                resultado += `üìè Dist√¢ncia total: ${estatisticas.distanciaTotal} km\n`;
                resultado += `‚è±Ô∏è Tempo estimado: ${Math.round(estatisticas.tempoEstimado/60)} horas (${estatisticas.tempoEstimado} minutos)\n`;
                resultado += `‚õΩ Combust√≠vel estimado: ${estatisticas.combustivel} litros\n\n`;
                resultado += `üí° C√°lculos baseados em:\n`;
                resultado += `   - Velocidade m√©dia: 50 km/h\n`;
                resultado += `   - Tempo por visita: 2 horas\n`;
                resultado += `   - Consumo: 12 km/litro\n`;
                
                resultDiv.innerHTML = `<span class="success">${resultado}</span>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
            }
        }

        function testarGeracaoHorarios() {
            const resultDiv = document.getElementById('result-schedule');
            resultDiv.style.display = 'block';
            
            try {
                const municipios = ['Navegantes', 'Balne√°rio Cambori√∫', 'Bombinhas'];
                const cronograma = gerarHorariosRota(municipios);
                
                let resultado = '‚è∞ TESTE DE CRONOGRAMA COMPLETO IBGE\n\n';
                resultado += `üìç Base: ${BASE_IBGE_ITAJAI.nome}\n`;
                resultado += `üìß Endere√ßo: ${BASE_IBGE_ITAJAI.endereco}\n`;
                resultado += `üìÖ Data: ${new Date().toLocaleDateString('pt-BR')}\n\n`;
                
                cronograma.forEach((item, index) => {
                    if (item.tipo === 'saida') {
                        resultado += `üöÄ SA√çDA DA BASE IBGE\n`;
                        resultado += `   ‚è∞ ${item.horario} - ${item.observacao}\n`;
                        resultado += `   üìç ${item.endereco}\n\n`;
                    } else if (item.tipo === 'visita') {
                        resultado += `üéØ VISITA ${item.sequencia} - ${item.municipio}\n`;
                        resultado += `   üöó Chegada: ${item.chegada} (viagem: ${item.tempoViagem})\n`;
                        resultado += `   üè¢ Sa√≠da: ${item.saida} (dura√ß√£o: ${item.duracaoVisita})\n\n`;
                    } else if (item.tipo === 'retorno') {
                        resultado += `üè† RETORNO √Ä BASE IBGE\n`;
                        resultado += `   ‚è∞ ${item.horario} (viagem: ${item.tempoViagem})\n`;
                        resultado += `   üìç ${item.endereco}\n`;
                        resultado += `   üìã ${item.observacao}\n`;
                    }
                });
                
                resultDiv.innerHTML = `<span class="success">${resultado}</span>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
            }
        }

        function testarDistancias() {
            const resultDiv = document.getElementById('result-distances');
            resultDiv.style.display = 'block';
            
            try {
                let resultado = 'üó∫Ô∏è TESTE DE C√ÅLCULO DE DIST√ÇNCIAS\n\n';
                resultado += 'üìç Coordenadas dos munic√≠pios PNSB SC:\n\n';
                
                Object.entries(COORDENADAS_MUNICIPIOS).forEach(([municipio, coords]) => {
                    resultado += `${municipio}: ${coords.lat}, ${coords.lng}\n`;
                });
                
                resultado += '\nüßÆ Exemplos de dist√¢ncias calculadas:\n\n';
                
                const exemplos = [
                    ['Itaja√≠', 'Navegantes'],
                    ['Balne√°rio Cambori√∫', 'Itapema'],
                    ['Bombinhas', 'Porto Belo'],
                    ['Itaja√≠', 'Luiz Alves']
                ];
                
                exemplos.forEach(([origem, destino]) => {
                    const distancia = calcularDistancia(
                        COORDENADAS_MUNICIPIOS[origem],
                        COORDENADAS_MUNICIPIOS[destino]
                    );
                    resultado += `${origem} ‚Üí ${destino}: ${Math.round(distancia * 10) / 10} km\n`;
                });
                
                resultado += '\n‚úÖ F√≥rmula Haversine implementada corretamente\n';
                resultado += '   (considera curvatura da Terra para precis√£o geogr√°fica)';
                
                resultDiv.innerHTML = `<span class="success">${resultado}</span>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
            }
        }

        function testarExportacaoCSV() {
            const resultDiv = document.getElementById('result-csv');
            resultDiv.style.display = 'block';
            
            try {
                const municipios = ['Itaja√≠', 'Navegantes', 'Balne√°rio Cambori√∫'];
                const horarios = gerarHorariosRota(municipios);
                const data = new Date().toLocaleDateString('pt-BR');
                
                // Simular dados de visitas
                const visitasSimuladas = [
                    { municipio: 'Itaja√≠', local: 'Prefeitura Municipal', status: 'agendada' },
                    { municipio: 'Navegantes', local: 'Secretaria de Meio Ambiente', status: 'agendada' },
                    { municipio: 'Balne√°rio Cambori√∫', local: 'SEMASA', status: 'agendada' }
                ];
                
                // Gerar CSV
                let csv = 'Sequencia,Municipio,Chegada,Saida,Local,Status\n';
                horarios.forEach((item, index) => {
                    const visita = visitasSimuladas.find(v => v.municipio === item.municipio) || {};
                    csv += `${index + 1},"${item.municipio}","${item.chegada}","${item.saida}","${visita.local || 'N√£o informado'}","${visita.status || 'agendada'}"\n`;
                });
                
                let resultado = 'üìÑ TESTE DE EXPORTA√á√ÉO CSV\n\n';
                resultado += `üìÖ Arquivo gerado para: ${data}\n`;
                resultado += `üìä Nome sugerido: rota_pnsb_${data.replace(/\//g, '-')}.csv\n\n`;
                resultado += 'üíæ Conte√∫do do arquivo CSV:\n\n';
                resultado += csv;
                resultado += '\n‚úÖ CSV gerado com sucesso!\n';
                resultado += '   Formato compat√≠vel com Excel e Google Sheets';
                
                resultDiv.innerHTML = `<span class="success">${resultado}</span>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå Erro: ${error.message}</span>`;
            }
        }

        // Auto-executar teste b√°sico ao carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ Sistema de testes carregado');
            console.log('üìä Fun√ß√µes dispon√≠veis: otimizarSequenciaMunicipios, calcularEstatisticasRota, gerarHorariosRota');
            console.log('üó∫Ô∏è Munic√≠pios PNSB SC:', Object.keys(COORDENADAS_MUNICIPIOS));
        });
    </script>
</body>
</html>